(()=>{var e={};e.id=413,e.ids=[413],e.modules={187:(e,r,t)=>{"use strict";t.d(r,{R:()=>n,Z:()=>i});var s=t(55511),a=t.n(s);function i(e){let r=a().createHash("sha1");return r.update(new Uint8Array(e)),r.digest("hex")}async function n(e){return new Promise((r,t)=>{let s=new FileReader;s.onload=()=>r(s.result),s.onerror=t,s.readAsArrayBuffer(e)})}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10762:e=>{"use strict";e.exports=import("@neondatabase/serverless")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},13440:e=>{"use strict";e.exports=require("util/types")},21379:(e,r,t)=>{"use strict";t.d(r,{B:()=>a});var s=t(13690);class a{async uploadFile(e,r){try{let t=Date.now(),a=e.name.split(".").pop(),i=`${t}.${a}`,n=`${r}/${i}`;return{url:(await (0,s.yJ)(n,e,{access:"public"})).url,path:n}}catch(e){throw console.error("Blob upload error:",e),Error(`Failed to upload file: ${e instanceof Error?e.message:"Unknown error"}`)}}async deleteFile(e){try{await (0,s.yH)(e)}catch(e){throw console.error("Blob delete error:",e),Error(`Failed to delete file: ${e instanceof Error?e.message:"Unknown error"}`)}}}},24467:()=>{},26418:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(r,{FH:()=>p,JE:()=>h,ME:()=>x,OJ:()=>y,aN:()=>_,ht:()=>f,jw:()=>m,kg:()=>d});var a=t(58617),i=t(62462),n=t(55511),o=t.n(n),u=e([i]);async function l(e){return a.Ay.hash(e,12)}async function c(e,r){return a.Ay.compare(e,r)}async function d(e,r,t){let s=await l(t),a=o().randomBytes(32).toString("hex");return(await (0,i.l)`
    INSERT INTO users (username, email, password_hash, verification_token)
    VALUES (${e}, ${r}, ${s}, ${a})
    RETURNING id, username, email, avatar_url, is_admin, is_verified, created_at
  `)[0]}async function p(e,r){let t=await (0,i.l)`
    SELECT id, username, email, password_hash, avatar_url, is_admin, is_verified, created_at
    FROM users
    WHERE (email = ${e} OR username = ${e}) AND is_verified = true
  `;if(t?.length===0)return null;let s=t[0];return await c(r,s.password_hash)?{id:s.id,username:s.username,email:s.email,avatar_url:s.avatar_url,is_admin:s.is_admin,is_verified:s.is_verified,created_at:s.created_at}:null}async function f(e){let r=await (0,i.l)`
    SELECT id, username, email, avatar_url, is_admin, is_verified, created_at
    FROM users
    WHERE email = ${e}
  `;return r?.length>0?r[0]:null}async function h(e){let r=await (0,i.l)`
    SELECT id, username, email, avatar_url, is_admin, is_verified, created_at
    FROM users
    WHERE username = ${e}
  `;return r?.length>0?r[0]:null}async function m(e){let r=o().randomBytes(32).toString("hex"),t=new Date(Date.now()+6048e5);return await (0,i.l)`
    INSERT INTO sessions (user_id, session_token, expires_at)
    VALUES (${e}, ${r}, ${t})
  `,r}async function _(e){let r=await (0,i.l)`
    SELECT u.id, u.username, u.email, u.avatar_url, u.is_admin, u.is_verified, u.created_at
    FROM users u
    JOIN sessions s ON u.id = s.user_id
    WHERE s.session_token = ${e} AND s.expires_at > NOW()
  `;return r?.length>0?r[0]:null}async function x(e){await (0,i.l)`DELETE FROM sessions WHERE session_token = ${e}`}async function y(e,r){await (0,i.l)`
    UPDATE users
    SET avatar_url = ${r}, updated_at = CURRENT_TIMESTAMP
    WHERE id = ${e}
  `}i=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},36686:e=>{"use strict";e.exports=require("diagnostics_channel")},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},54287:e=>{"use strict";e.exports=require("console")},55511:e=>{"use strict";e.exports=require("crypto")},57075:e=>{"use strict";e.exports=require("node:stream")},57975:e=>{"use strict";e.exports=require("node:util")},60993:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(r,{H:()=>o,U:()=>n});var a=t(26418),i=e([a]);async function n(e){try{let r=e.cookies.get("session-token")?.value;if(!r)return!1;let t=await (0,a.aN)(r);return t?.is_admin===!0}catch(e){return!1}}async function o(e){try{let r=e.cookies.get("session-token")?.value;if(!r)return null;return await (0,a.aN)(r)}catch(e){return null}}a=(i.then?(await i)():i)[0],s()}catch(e){s(e)}})},61419:()=>{},62462:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(r,{l:()=>n});var a=t(10762),i=e([a]);a=(i.then?(await i)():i)[0];let n=(0,a.neon)("postgres://neondb_owner:npg_S3FPlxKdyQ6j@ep-floral-heart-adkjfqfm-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require");s()}catch(e){s(e)}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73496:e=>{"use strict";e.exports=require("http2")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},74998:e=>{"use strict";e.exports=require("perf_hooks")},77598:e=>{"use strict";e.exports=require("node:crypto")},78474:e=>{"use strict";e.exports=require("node:events")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},84297:e=>{"use strict";e.exports=require("async_hooks")},91645:e=>{"use strict";e.exports=require("net")},93990:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{POST:()=>c});var a=t(28142),i=t(62462),n=t(60993),o=t(21379),u=t(187),l=e([i,n]);async function c(e){try{if(!await (0,n.U)(e))return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=(await e.formData()).get("file");if(!r)return a.NextResponse.json({error:"No file provided"},{status:400});let t=r.type,s=r.size,l=r.name,c=await (0,u.R)(r),d=(0,u.Z)(c),p=await (0,i.l)`
      SELECT * FROM files WHERE file_hash = ${d} LIMIT 1
    `;if(p?.length>0){let e=p[0];return a.NextResponse.json({success:!0,file:e,url:e.file_path.startsWith("http")?e.file_path:`https://your-blob-url.com/${e.file_path}`,duplicate:!0,message:"File already exists, using existing file"})}let f="other";t.startsWith("image/")?f="images":t.startsWith("video/")?f="videos":t.startsWith("audio/")?f="audio":"application/pdf"===t&&(f="documents");let h=new o.B,{url:m,path:_}=await h.uploadFile(r,f),x=await (0,i.l)`
      INSERT INTO files (filename, original_name, file_path, file_type, file_size, folder, file_hash)
      VALUES (${_.split("/").pop()}, ${l}, ${m}, ${t}, ${s}, ${f}, ${d})
      RETURNING *
    `;return a.NextResponse.json({success:!0,file:x[0],url:m,duplicate:!1})}catch(e){return console.error("Upload error:",e),a.NextResponse.json({error:e instanceof Error?e.message:"Upload failed"},{status:500})}}[i,n]=l.then?(await l)():l,s()}catch(e){s(e)}})},94175:e=>{"use strict";e.exports=require("stream/web")},94735:e=>{"use strict";e.exports=require("events")},97466:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{patchFetch:()=>l,routeModule:()=>c,serverHooks:()=>f,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>p});var a=t(43007),i=t(44360),n=t(98343),o=t(93990),u=e([o]);o=(u.then?(await u)():u)[0];let c=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"E:\\front\\MarsLemon's-Blog\\app\\api\\upload\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:p,serverHooks:f}=c;function l(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:p})}s()}catch(e){s(e)}})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[535,960,690],()=>t(97466));module.exports=s})();